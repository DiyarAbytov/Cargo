.parcels{
  --primary:#C1116A; --primary-600:#A30E5B; --accent:#E8892D;
  --text:#111317; --muted:#6b7280; --border:#e5e7eb;
  --surface:#fff; --bg:#f5f6f8; --success:#16a34a; --danger:#dc2626;

  &, * { box-sizing: border-box; }
  min-height:100dvh;
  display:grid;
  grid-template-rows:auto;
  background:var(--bg);
  color:var(--text);
  font-size:14px;
  line-height:1.35;
  padding-top:6px;
  overflow-x:clip;
  -webkit-text-size-adjust:100%;
  @supports (padding:max(0px)){ padding-top:max(env(safe-area-inset-top),6px); }

  input, textarea, select, button { font-size:16px; }
  @supports (-webkit-touch-callout:none){ input,textarea,select,button{ font-size:16px; } }

  &__card{
    width:100%; max-width:420px;
    padding:8px 16px 16px;
    justify-self:center;
    display:grid; gap:18px;
    align-content:start;
  }

  &__logo{
    display:flex; align-items:center; justify-content:flex-start;
    margin:0 0 4px; line-height:0;
    img{ height:66px; display:block; object-fit:contain; }
  }

  &__block{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px 12px;
    display:grid; gap:12px;
  }
  &__block-title{ font-weight:700; font-size:14px; }

  &__inputs{ display:grid; gap:8px; }
  &__track-row{ position:relative; }

  &__input{
    width:100%; height:48px;
    border-radius:12px; outline:none;
    border:1px solid var(--border);
    background:var(--surface);
    padding:0 12px;
    font-size:16px;
    &:focus{ border-color:var(--primary); box-shadow:0 0 0 3px rgba(193,17,106,.12); }
  }

  &__menu{
    position:absolute; left:0; right:0; top:calc(100% + 6px); z-index:20;
    background:var(--surface); border:1px solid var(--border);
    border-radius:12px; box-shadow:0 12px 24px rgba(0,0,0,.12);
  }
  &__list{ max-height:220px; overflow:auto; }
  &__option{ padding:10px 12px; cursor:pointer; &:hover{ background:#fafafa; } }
  &__empty{ padding:12px; color:var(--muted); }

  &__btn{
    width:100%; height:44px; border:0; border-radius:10px;
    background:var(--primary); color:#fff; font-weight:700; cursor:pointer;
  }
  &__btn:active{ background:var(--primary-600); }

  &__success{
    background:#ecfdf5; border:1px solid #bbf7d0; color:var(--success);
    padding:10px 12px; border-radius:10px; font-size:13px;
  }
  &__error{ color:var(--danger); font-size:12px; }
  &__hint{ color:var(--muted); font-size:12px; }

  &__grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }

  &__stage{
    position:relative;
    background:var(--surface);
    border:1.5px solid var(--primary);
    border-radius:16px;
    padding:12px; min-height:64px;
    display:grid; align-content:center;
    text-align:left; cursor:pointer;
    &:active{ transform:translateY(1px); }
  }
  &__stage-label{ font-size:13px; }

  &__badge{
    position:absolute; top:-9px; right:-9px;
    display:grid; place-items:center;
    min-width:22px; height:22px; padding:0 6px;
    background:#fff; border:2px solid var(--accent); color:var(--accent);
    border-radius:999px; font-size:12px; font-weight:700;
  }

  &__results{
    background:var(--surface); border:1px solid var(--border);
    border-radius:12px; padding:12px; display:grid; gap:8px;
  }
  &__results-title{ font-weight:700; }

  &__bucket{ display:grid; gap:6px; }
  &__bucket-title{ color:var(--muted); font-size:12px; }
  &__bucket-list{ display:flex; flex-wrap:wrap; gap:6px; }
  &__tag{
    border:1px solid var(--border); border-radius:999px;
    padding:4px 8px; font-size:12px; background:#fafafa;
  }

  &__visually-hidden{
    position:absolute!important; width:1px; height:1px; margin:-1px; padding:0; overflow:hidden;
    clip:rect(0 0 0 0); white-space:nowrap; border:0;
  }

  /* ===== Modal ===== */
  .modal{
    position:fixed; inset:0; z-index:50;

    &__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.35); }

    &__dialog{
      position:absolute; left:50%; top:50%; transform:translate(-50%, -50%);
      width: calc(100vw - 24px);
      max-width:560px; max-height:84vh;
      background:#fff; border-radius:14px; border:1px solid var(--border);
      display:grid; grid-template-rows:auto 1fr; overflow:hidden;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }

    &__header{
      display:grid; grid-template-columns:1fr auto; align-items:center;
      padding:12px 14px; border-bottom:1px solid var(--border);
    }
    &__title{ font-weight:700; }
    &__actions{ display:flex; gap:6px; align-items:center; }
    &__action{
      border:1px solid var(--border); background:#fff; border-radius:8px;
      width:32px; height:32px; cursor:pointer;
    }
    &__close{
      width:32px; height:32px; border:0; background:transparent;
      cursor:pointer; font-size:22px; line-height:1; color:var(--muted);
    }
    &__body{ overflow:auto; padding:12px; }
    &__muted{ color:var(--muted); }
    &__error{ color:var(--danger); }
    &__list{ display:grid; gap:12px; }
  }

  /* карточка в модалке */
  .modalcard{
    width:100%;
    text-align:left;
    background:#fff;
    border:1px solid var(--border);
    border-radius:12px;
    box-shadow:0 2px 10px rgba(0,0,0,.06);
    padding:12px;
    display:block;
    cursor:pointer;
  }
  .modalcard__row{ display:grid; grid-template-columns:96px 1fr; gap:8px; padding:2px 0; }
  .modalcard__key{ font-weight:700; color:#111317; }
  .modalcard__val{ color:#374151; word-break:break-word; }

  /* ===== ТАЙМЛАЙН — идеальное совпадение кружка и линии ===== */
  .timeline{
    /* ширина левой колонки (рельса), толщина линии и диаметр точки */
    --rail: 28px;
    --line: 2px;
    --dot: 12px;
    position:relative;
  }

  /* вертикальная пунктирная линия по центру rail */
  .timeline::before{
    content:"";
    position:absolute;
    left: calc(var(--rail) / 2 - var(--line) / 2); /* центр линии совмещён с центром rail */
    top:8px;
    bottom:8px;
    width: var(--line);
    border-left: var(--line) dashed rgba(232,137,45,.55);
  }

  /* каждый элемент — сетка: колонка-рельса + колонка с контентом */
  .timeline__item{
    display:grid;
    grid-template-columns: var(--rail) 1fr;
    column-gap:12px;
    align-items:start;
    padding:10px 0;
    position:relative;
  }

  /* точка идеально по центру первой колонки */
  .timeline__dot{
    grid-column:1;
    justify-self:center;
    align-self:start;
    width:var(--dot);
    height:var(--dot);
    border-radius:50%;
    background:var(--surface);
    border:3px solid var(--accent);
    box-sizing:content-box;
    z-index:1;
  }
  .timeline__dot.is-current{ background:var(--accent); border-color:var(--accent); }

  /* контент всегда во второй колонке — текст не заходит на рельсу */
  .timeline__content{ grid-column:2; min-width:0; }
  .timeline__title{ font-weight:600; line-height:1.35; }
  .timeline__time{ font-size:12px; color:#9ca3af; margin-top:4px; }

  /* запасной блок (если понадобится) */
  .parcelcard{
    border:1px solid var(--border); border-radius:12px; padding:10px 12px; background:#fff;
    &__row{ display:grid; grid-template-columns:120px 1fr; gap:8px; padding:3px 0; }
  }

  @media (max-width:360px){
    &__input{ height:46px; }
    .modalcard__row{ grid-template-columns:84px 1fr; }
  }
}
